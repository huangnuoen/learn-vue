# 思路

1. 知道data什么时候改变
2. 知道哪些dom需要用到data,当触发setter时把所有用到该数据的dom更新

Dep可以看做是书店，Watcher就是书店订阅者，而Observer就是书店的书，订阅者在书店订阅书籍，就可以添加订阅者信息，一旦有新书就会通过书店给订阅者发送消息。

Dep收集watcher,ob监听数据变化，一有变化，dep会通知收集的watcher,watcher再去触发对应的视图更新

## Observer

### 对data作监听
1. `initData`
1.1. 对data.key作完验证后执行`proxy(vm, `_data`, key)`,把_data代理到vm实例上
1.2. 执行`observe(data, true /* asRootData */)`

## 收集依赖
依赖可以理解成当前数据绑定的视图组(watcher)，一个key有一个deps
```
get: function reactiveGetter () {
  const value = getter ? getter.call(obj) : val
  // 依赖收集过程
  if (Dep.target) {
    dep.depend()
    if (childOb) {
      childOb.dep.depend()
      if (Array.isArray(value)) {
        dependArray(value)
      }
    }
  }
  return value
},
```
1. dep.depend()
```
depend () {
  if (Dep.target) {
    Dep.target.addDep(this)
  }
}
```
2. `Dep.target.addDep(this)`
## Watcher订阅